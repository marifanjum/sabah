<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Social Card Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/jameel-noori@1.1.2/jameel-noori.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      @font-face {
        font-family: "Pangea Afrikan Trial";
        src: url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.eot");
        src: url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.eot?#iefix") format("embedded-opentype"),
          url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.woff2") format("woff2"),
          url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.woff") format("woff"),
          url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.ttf") format("truetype"),
          url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.svg#Pangea Afrikan Trial") format("svg");
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
      function SocialCardGenerator() {
        const { useState, useRef, useEffect } = React;
        const containerRef = useRef(null);

        // --- New background states ---
        const [useBackgroundImage, setUseBackgroundImage] = useState(false);
        const [backgroundImage, setBackgroundImage] = useState(null);
        const [useGradient, setUseGradient] = useState(false);
        const [gradient, setGradient] = useState({
          color1: "#000000",
          color2: "#ffffff",
          direction: "to bottom",
        });

        // --- Existing states ---
        const [images, setImages] = useState([]);
        const [activeImageId, setActiveImageId] = useState(null);
        const [width, setWidth] = useState(1080);
        const [height, setHeight] = useState(1080);
        const [logo, setLogo] = useState({ show: true, position: "top-right" });
        const [fileName, setFileName] = useState("social-card");
        const [fitMode, setFitMode] = useState("cover");
        const [vignette, setVignette] = useState({ show: false, x: 0, y: 0, scale: 1 });
        const [globalBorderColor, setGlobalBorderColor] = useState("#ffffff");
        const [globalBorderSize, setGlobalBorderSize] = useState(4);

        // Headlines
        const [headlines, setHeadlines] = useState([
          {
            id: Date.now(),
            text: "Headline here",
            fontSize: 90,
            lineHeight: 1.2,
            fontFamily: "JameelNooriNastaliq",
            textColor: "#ffffff",
            textPos: { x: 100, y: 200 },
            direction: "rtl",
            sidelineOffset: 0,
            shadow: { enabled: true, offsetX: 2, offsetY: 2, blur: 6, color: "rgba(0,0,0,0.6)" },
            stroke: { enabled: false, width: 1, color: "#000000" },
            sideline: { show: true, width: 30, gap: 60, height: 0, color: "#ff0000", opacity: 1 },
            isCollapsed: false,
          },
        ]);

        // --- Background style ---
        const backgroundStyle = {};
        if (useBackgroundImage && backgroundImage) {
          backgroundStyle.backgroundImage = `url(${backgroundImage})`;
          backgroundStyle.backgroundSize = "cover";
          backgroundStyle.backgroundPosition = "center";
        } else if (useGradient) {
          backgroundStyle.backgroundImage = `linear-gradient(${gradient.direction}, ${gradient.color1}, ${gradient.color2})`;
        } else {
          backgroundStyle.backgroundColor = "#000";
        }

        // --- Presets save/load (with background) ---
        function savePreset(name) {
          if (!name) {
            alert("Please enter a preset name");
            return;
          }
          const newPreset = {
            headlines,
            images,
            width,
            height,
            logo,
            fileName,
            fitMode,
            vignette,
            globalBorderColor,
            globalBorderSize,
            useBackgroundImage,
            backgroundImage,
            useGradient,
            gradient,
          };
          const saved = localStorage.getItem("userPresets");
          const presets = saved ? JSON.parse(saved) : {};
          const updated = { ...presets, [name]: newPreset };
          localStorage.setItem("userPresets", JSON.stringify(updated));
          alert(`Preset "${name}" saved!`);
        }

        function loadPreset(name) {
          const saved = localStorage.getItem("userPresets");
          const presets = saved ? JSON.parse(saved) : {};
          const preset = presets[name];
          if (!preset) {
            alert("Preset not found");
            return;
          }
          setHeadlines(preset.headlines || []);
          setImages(preset.images || []);
          if (preset.width) setWidth(preset.width);
          if (preset.height) setHeight(preset.height);
          if (preset.logo) setLogo(preset.logo);
          if (preset.fileName) setFileName(preset.fileName);
          if (preset.fitMode) setFitMode(preset.fitMode);
          if (preset.vignette) setVignette(preset.vignette);
          if (preset.globalBorderColor) setGlobalBorderColor(preset.globalBorderColor);
          if (preset.globalBorderSize !== undefined) setGlobalBorderSize(preset.globalBorderSize);
          if (preset.useBackgroundImage !== undefined) setUseBackgroundImage(preset.useBackgroundImage);
          if (preset.backgroundImage) setBackgroundImage(preset.backgroundImage);
          if (preset.useGradient !== undefined) setUseGradient(preset.useGradient);
          if (preset.gradient) setGradient(preset.gradient);
          alert(`${name} preset loaded!`);
        }

        // --- Render ---
        return (
          <div className="flex">
            {/* Controls */}
            <div className="w-80 p-4 bg-white overflow-y-auto h-screen border-r">
              <h2 className="text-lg font-bold mb-2">Controls</h2>

              {/* Global border */}
              <div className="mb-4">
                <label className="block">Border Color</label>
                <input type="color" value={globalBorderColor} onChange={e => setGlobalBorderColor(e.target.value)} />
                <label className="block">Border Size</label>
                <input type="number" value={globalBorderSize} min="0" onChange={e => setGlobalBorderSize(parseInt(e.target.value))} />
              </div>

              {/* Background controls */}
              <div className="mb-4">
                <h3 className="font-semibold">Background</h3>
                <label className="block">
                  <input type="checkbox" checked={useBackgroundImage} onChange={e => setUseBackgroundImage(e.target.checked)} />
                  Use background image
                </label>
                {useBackgroundImage && (
                  <input type="file" accept="image/*" onChange={e => {
                    const file = e.target.files[0];
                    if (file) {
                      const url = URL.createObjectURL(file);
                      setBackgroundImage(url);
                    }
                  }} />
                )}
                <label className="block mt-2">
                  <input type="checkbox" checked={useGradient} onChange={e => setUseGradient(e.target.checked)} />
                  Use gradient
                </label>
                {useGradient && (
                  <div className="ml-4">
                    <label>Color 1</label>
                    <input type="color" value={gradient.color1} onChange={e => setGradient({ ...gradient, color1: e.target.value })} />
                    <label>Color 2</label>
                    <input type="color" value={gradient.color2} onChange={e => setGradient({ ...gradient, color2: e.target.value })} />
                    <label>Direction</label>
                    <select value={gradient.direction} onChange={e => setGradient({ ...gradient, direction: e.target.value })}>
                      <option value="to bottom">Top → Bottom</option>
                      <option value="to right">Left → Right</option>
                    </select>
                  </div>
                )}
              </div>

              {/* Preset controls */}
              <div className="mb-4">
                <input id="presetName" type="text" placeholder="Preset name" className="border p-1 w-full mb-2" />
                <button className="bg-blue-500 text-white px-2 py-1 mr-2" onClick={() => savePreset(document.getElementById("presetName").value)}>Save</button>
                <button className="bg-green-500 text-white px-2 py-1" onClick={() => loadPreset(document.getElementById("presetName").value)}>Load</button>
              </div>
            </div>

            {/* Canvas */}
            <div className="flex-1 flex items-center justify-center">
              <div
                ref={containerRef}
                style={{
                  width: width,
                  height: height,
                  border: `${globalBorderSize}px solid ${globalBorderColor}`,
                  ...backgroundStyle,
                }}
                className="relative"
              >
                {/* Headlines */}
                {headlines.map(h => (
                  <div
                    key={h.id}
                    style={{
                      position: "absolute",
                      left: h.textPos.x,
                      top: h.textPos.y,
                      fontSize: h.fontSize,
                      lineHeight: h.lineHeight,
                      fontFamily: h.fontFamily,
                      color: h.textColor,
                      textShadow: h.shadow.enabled ? `${h.shadow.offsetX}px ${h.shadow.offsetY}px ${h.shadow.blur}px ${h.shadow.color}` : "none",
                      WebkitTextStroke: h.stroke.enabled ? `${h.stroke.width}px ${h.stroke.color}` : "none",
                      direction: h.direction,
                      cursor: "move",
                    }}
                  >
                    {h.text}
                  </div>
                ))}
              </div>
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<SocialCardGenerator />);
    </script>
  </body>
</html>
