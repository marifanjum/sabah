<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Social Card Generator</title>
  <link href="https://cdn.jsdelivr.net/npm/jameel-noori@1.1.2/jameel-noori.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    @font-face {
      font-family: "Pangea Afrikan Trial";
      src: url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.eot");
      src: url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.eot?#iefix") format("embedded-opentype"),
        url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.woff2") format("woff2"),
        url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.woff") format("woff"),
        url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.ttf") format("truetype"),
        url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.svg#Pangea Afrikan Trial") format("svg");
    }
  </style>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">

    function SocialCardGenerator() {
      const { useState, useRef } = React;
      const containerRef = useRef(null);

      // --- New Background Options ---
      const [backgroundImage, setBackgroundImage] = useState(null);
      const [useBackgroundImage, setUseBackgroundImage] = useState(false);

      const [useGradient, setUseGradient] = useState(false);
      const [gradient, setGradient] = useState({
        color1: "#000000",
        color2: "#ffffff",
        direction: "to bottom"
      });

      // --- Existing States ---
      const [images, setImages] = useState([]);
      const [width, setWidth] = useState(1080);
      const [height, setHeight] = useState(1080);
      const [logo, setLogo] = useState({ show: true, position: "top-right" });
      const [fileName, setFileName] = useState("social-card");
      const [fitMode, setFitMode] = useState("cover");
      const [vignette, setVignette] = useState({ show: false, x: 0, y: 0, scale: 1 });

      const [globalBorderColor, setGlobalBorderColor] = useState("#ffffff");
      const [globalBorderSize, setGlobalBorderSize] = useState(4);

      const [headlines, setHeadlines] = useState([{
        id: Date.now(),
        text: "Headline here",
        fontSize: 90,
        lineHeight: 1.2,
        fontFamily: "JameelNooriNastaliq",
        textColor: "#ffffff",
        textPos: { x: 100, y: 200 },
        direction: "rtl",
        shadow: { enabled: true, offsetX: 2, offsetY: 2, blur: 6, color: "rgba(0,0,0,0.6)" },
        stroke: { enabled: false, width: 1, color: "#000000" },
        isCollapsed: false,
      }]);

      // --- Presets ---
      const DEFAULT_PRESETS = {};
      const [presets, setPresets] = useState(() => {
        const saved = localStorage.getItem("userPresets");
        return { ...DEFAULT_PRESETS, ...(saved ? JSON.parse(saved) : {}) };
      });

      // --- Save Preset ---
      function savePreset(name) {
        if (!name) {
          alert("Please enter a preset name");
          return;
        }

        const newPreset = {
          headlines: JSON.parse(JSON.stringify(headlines)),
          images: JSON.parse(JSON.stringify(images)),
          width, height, logo, fileName, fitMode, vignette,
          globalBorderColor, globalBorderSize,
          backgroundImage, useBackgroundImage,
          gradient, useGradient
        };

        const updatedPresets = { ...presets, [name]: newPreset };
        setPresets(updatedPresets);
        localStorage.setItem("userPresets", JSON.stringify(updatedPresets));
        alert(`Preset "${name}" saved!`);
      }

      // --- Load Preset ---
      function loadPreset(name) {
        const preset = presets[name];
        if (!preset) {
          alert("Preset not found");
          return;
        }

        setHeadlines(preset.headlines ? JSON.parse(JSON.stringify(preset.headlines)) : []);
        setImages(preset.images ? JSON.parse(JSON.stringify(preset.images)) : []);
        if (preset.width) setWidth(preset.width);
        if (preset.height) setHeight(preset.height);
        if (preset.logo) setLogo(preset.logo);
        if (preset.fileName) setFileName(preset.fileName);
        if (preset.fitMode) setFitMode(preset.fitMode);
        if (preset.vignette !== undefined) setVignette(preset.vignette);
        if (preset.globalBorderColor) setGlobalBorderColor(preset.globalBorderColor);
        if (preset.globalBorderSize !== undefined) setGlobalBorderSize(preset.globalBorderSize);
        if (preset.backgroundImage !== undefined) setBackgroundImage(preset.backgroundImage);
        if (preset.useBackgroundImage !== undefined) setUseBackgroundImage(preset.useBackgroundImage);
        if (preset.gradient) setGradient(preset.gradient);
        if (preset.useGradient !== undefined) setUseGradient(preset.useGradient);

        alert(`${name} preset loaded!`);
      }

      // --- Background Upload ---
      function handleBackgroundUpload(e) {
        const file = e.target.files[0];
        if (!file) return;
        setBackgroundImage(URL.createObjectURL(file));
        setUseBackgroundImage(true);
      }

      // --- Background Style ---
      const backgroundStyle = {};
      if (useBackgroundImage && backgroundImage) {
        backgroundStyle.backgroundImage = `url(${backgroundImage})`;
        backgroundStyle.backgroundSize = "cover";
        backgroundStyle.backgroundPosition = "center";
      } else if (useGradient) {
        backgroundStyle.backgroundImage = `linear-gradient(${gradient.direction}, ${gradient.color1}, ${gradient.color2})`;
      } else {
        backgroundStyle.backgroundColor = "#000";
      }

      return (
        <div className="flex">
          {/* Controls */}
          <div className="w-1/4 p-4 space-y-4 bg-white overflow-y-auto">
            <h2 className="font-bold">Background Options</h2>

            <label className="flex items-center space-x-2">
              <input type="checkbox" checked={useBackgroundImage} onChange={(e) => setUseBackgroundImage(e.target.checked)} />
              <span>Use background image</span>
            </label>
            {useBackgroundImage && (
              <input type="file" accept="image/*" onChange={handleBackgroundUpload} />
            )}

            <label className="flex items-center space-x-2">
              <input type="checkbox" checked={useGradient} onChange={(e) => setUseGradient(e.target.checked)} />
              <span>Use gradient</span>
            </label>
            {useGradient && (
              <div className="space-y-2">
                <input type="color" value={gradient.color1} onChange={(e) => setGradient({ ...gradient, color1: e.target.value })} />
                <input type="color" value={gradient.color2} onChange={(e) => setGradient({ ...gradient, color2: e.target.value })} />
                <select value={gradient.direction} onChange={(e) => setGradient({ ...gradient, direction: e.target.value })}>
                  <option value="to bottom">Top to Bottom</option>
                  <option value="to right">Left to Right</option>
                  <option value="to left">Right to Left</option>
                  <option value="to top">Bottom to Top</option>
                </select>
              </div>
            )}

            <h2 className="font-bold mt-4">Presets</h2>
            <div className="flex space-x-2">
              <button onClick={() => savePreset(prompt("Preset name?"))} className="px-2 py-1 bg-blue-500 text-white rounded">Save</button>
              <button onClick={() => loadPreset(prompt("Preset name?"))} className="px-2 py-1 bg-green-500 text-white rounded">Load</button>
            </div>
          </div>

          {/* Canvas */}
          <div className="flex-1 flex items-center justify-center">
            <div
              ref={containerRef}
              className="relative"
              style={{
                width: width + "px",
                height: height + "px",
                ...backgroundStyle,
                border: `${globalBorderSize}px solid ${globalBorderColor}`
              }}
            >
              {/* Headlines */}
              {headlines.map(h => (
                <div
                  key={h.id}
                  style={{
                    position: "absolute",
                    top: h.textPos.y,
                    left: h.textPos.x,
                    fontSize: h.fontSize + "px",
                    lineHeight: h.lineHeight,
                    fontFamily: h.fontFamily,
                    color: h.textColor,
                    textShadow: h.shadow.enabled ? `${h.shadow.offsetX}px ${h.shadow.offsetY}px ${h.shadow.blur}px ${h.shadow.color}` : "none",
                    WebkitTextStroke: h.stroke.enabled ? `${h.stroke.width}px ${h.stroke.color}` : "none",
                  }}
                >
                  {h.text}
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<SocialCardGenerator />);

  </script>
</body>
</html>
