<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Social Card Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      @font-face {
        font-family: "Pangea Afrikan Trial";
        src: url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.eot");
        src: url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.eot?#iefix") format("embedded-opentype"),
          url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.woff2") format("woff2"),
          url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.woff") format("woff"),
          url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.ttf") format("truetype"),
          url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.svg#Pangea Afrikan Trial") format("svg");
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
      function SocialCardGenerator() {
        const { useState, useRef, useEffect } = React;
        const containerRef = useRef(null);
        const textRef = useRef(null);

        // --- Multi-image support ---
        const [images, setImages] = useState([]); // {id, src, x, y, scale, zIndex}
		// --- Active image selection ---
const [activeImageId, setActiveImageId] = useState(null);


        // --- Canvas & Text ---
        const [width, setWidth] = useState(1080);
        const [height, setHeight] = useState(1080);
        const [headline, setHeadline] = useState("Headline here");
        const [fontSize, setFontSize] = useState(72);
        const [lineHeight, setLineHeight] = useState(1.2);
        const [fontFamily, setFontFamily] = useState("Jameel Noori Nastaleeq");
        const [textColor, setTextColor] = useState("#ffffff");
        const [textPos, setTextPos] = useState({ x: 100, y: 200 });
        const [direction, setDirection] = useState("rtl");
        const [logo, setLogo] = useState({ show: true, position: "top-right" });
        const [fileName, setFileName] = useState("social-card");
        const [sidelineOffset, setSidelineOffset] = useState(0);

        // --- Shadow & Stroke ---
        const [shadow, setShadow] = useState({ enabled: true, offsetX: 2, offsetY: 2, blur: 6, color: "rgba(0,0,0,0.6)" });
        const [stroke, setStroke] = useState({ enabled: false, width: 1, color: "#000000" });
        const [sideline, setSideline] = useState({ show: true, width: 4, gap: 8, height: 0, color: "#ff0000", opacity: 1 });

        const [fitMode, setFitMode] = useState("cover");

        useEffect(() => {
          if (textRef.current && sideline.height === 0) {
            setSideline((s) => ({ ...s, height: textRef.current.offsetHeight }));
          }
        }, [headline, fontSize, lineHeight, fontFamily]);

        // --- Image Upload ---
        function onImageUpload(e) {
          const files = e.target.files;
          if (!files) return;
          const newImages = Array.from(files).map((file, index) => ({
            id: Date.now() + index,
            src: URL.createObjectURL(file),
            x: 0, y: 0, scale: 1, zIndex: images.length + index
          }));
          setImages([...images, ...newImages]);
        }

        // --- Dragging ---
        function startDragImage(e, id) {
          e.preventDefault();
          const startX = e.clientX;
          const startY = e.clientY;
          const img = images.find(im => im.id === id);
          const initX = img.x, initY = img.y;
          const maxZ = Math.max(...images.map(im => im.zIndex));
          setImages((imgs) => imgs.map(im => im.id === id ? {...im, zIndex: maxZ+1} : im));

          function onMove(ev) {
            setImages((imgs) => imgs.map(im => im.id === id ? {...im, x: initX + ev.clientX-startX, y: initY + ev.clientY-startY} : im));
          }
          function onUp() { window.removeEventListener("mousemove", onMove); window.removeEventListener("mouseup", onUp);}
          window.addEventListener("mousemove", onMove);
          window.addEventListener("mouseup", onUp);
        }

        function startDragText(e) {
          e.preventDefault();
          const startX = e.clientX, startY = e.clientY;
          const initPos = {...textPos};
          function onMove(ev){ setTextPos({x:initPos.x+ev.clientX-startX, y:initPos.y+ev.clientY-startY})}
          function onUp(){ window.removeEventListener("mousemove", onMove); window.removeEventListener("mouseup", onUp)}
          window.addEventListener("mousemove", onMove); window.addEventListener("mouseup", onUp);
        }

        // --- Export ---
        function exportAsImage() {
          if (!containerRef.current) return;
          const verticalOffset = 3;
          html2canvas(containerRef.current, {useCORS:true, scale:1, onclone:(clonedDoc)=> {
            const clonedLine = clonedDoc.querySelector(".sideline-clone");
            if(clonedLine){ const currentTop = parseFloat(clonedLine.style.top||"0"); clonedLine.style.top=currentTop+verticalOffset+"px";}
          }}).then((canvas)=>{
            const link = document.createElement("a");
            link.download = (fileName && fileName.trim()?fileName.trim():"social-card")+".png";
            link.href = canvas.toDataURL("image/png"); link.click();
          });
        }

        // --- Per-image controls ---
        function changeImageScale(id, scale){ setImages((imgs)=>imgs.map(im=>im.id===id?{...im, scale}:im)) }
        function bringForward(id){ const maxZ=Math.max(...images.map(im=>im.zIndex)); setImages((imgs)=>imgs.map(im=>im.id===id?{...im,zIndex:maxZ+1}:im)) }
        function sendBackward(id){ const minZ=Math.min(...images.map(im=>im.zIndex)); setImages((imgs)=>imgs.map(im=>im.id===id?{...im,zIndex:minZ-1}:im)) }
        function deleteImage(id){ setImages((imgs)=>imgs.filter(im=>im.id!==id)) }
function selectImage(id) {
  setActiveImageId(id);
  // Bring selected image to top visually
  const maxZ = Math.max(...images.map(im => im.zIndex));
  setImages((imgs) => imgs.map(im => im.id === id ? { ...im, zIndex: maxZ + 1 } : im));
}

        return (
          <div className="p-4 max-w-7xl mx-auto">
            <div className="flex gap-6">
              {/* Controls */}
              <div className="w-96 space-y-4">
                <h2 className="text-xl font-semibold">Controls</h2>

                {/* Headline */}
                <div className="bg-white p-3 rounded shadow">
                  <label className="block text-sm font-medium">Headline</label>
                  <textarea dir={direction} value={headline} onChange={e=>setHeadline(e.target.value)} className="w-full border p-2 rounded" />
                  <label className="block text-sm mt-2">Font size</label>
                  <input type="number" value={fontSize} onChange={e=>setFontSize(parseInt(e.target.value))} className="w-full border p-1 rounded"/>
                  <label className="block text-sm mt-2">Line height</label>
                  <input type="number" step="0.1" value={lineHeight} onChange={e=>setLineHeight(parseFloat(e.target.value))} className="w-full border p-1 rounded"/>
                  <label className="block text-sm mt-2">Text color</label>
                  <input type="color" value={textColor} onChange={e=>setTextColor(e.target.value)}/>
                  <label className="block text-sm mt-3">Font family</label>
                  <select value={fontFamily} onChange={e=>setFontFamily(e.target.value)} className="w-full border p-1 rounded mt-2">
                    <option value="Jameel Noori Nastaleeq">Jameel Noori Nastaleeq</option>
                    <option value="Pangea Afrikan Trial">Pangea</option>
                    <option value="Tahoma">Tahoma</option>
                    <option value="Arial">Arial</option>
                  </select>
                  <label className="block text-sm mt-3">Text direction</label>
                  <select value={direction} onChange={e=>setDirection(e.target.value)} className="w-full border p-1 rounded mt-2">
                    <option value="ltr">Left to Right</option>
                    <option value="rtl">Right to Left</option>
                  </select>
                </div>

                {/* Shadow */}
                <div className="bg-white p-3 rounded shadow">
                  <label className="flex items-center">
                    <input type="checkbox" checked={shadow.enabled} onChange={e=>setShadow({...shadow,enabled:e.target.checked})}/>
                    <span className="ml-2">Enable shadow</span>
                  </label>
                  {shadow.enabled && <div className="mt-2 grid grid-cols-2 gap-2">
                    <label className="text-sm">OffsetX<input type="number" value={shadow.offsetX} onChange={e=>setShadow({...shadow,offsetX:parseInt(e.target.value)})} className="w-full border p-1 rounded"/></label>
                    <label className="text-sm">OffsetY<input type="number" value={shadow.offsetY} onChange={e=>setShadow({...shadow,offsetY:parseInt(e.target.value)})} className="w-full border p-1 rounded"/></label>
                    <label className="text-sm">Blur<input type="number" value={shadow.blur} onChange={e=>setShadow({...shadow,blur:parseInt(e.target.value)})} className="w-full border p-1 rounded"/></label>
                    <label className="text-sm">Color<input type="color" value={shadow.color} onChange={e=>setShadow({...shadow,color:e.target.value})} className="w-full border p-1 rounded"/></label>
                  </div>}
                </div>

                {/* Stroke */}
                <div className="bg-white p-3 rounded shadow">
                  <label className="flex items-center">
                    <input type="checkbox" checked={stroke.enabled} onChange={e=>setStroke({...stroke,enabled:e.target.checked})}/>
                    <span className="ml-2">Enable stroke</span>
                  </label>
                  {stroke.enabled && <div className="mt-2 grid grid-cols-2 gap-2">
                    <label className="text-sm">Width<input type="number" value={stroke.width} onChange={e=>setStroke({...stroke,width:parseInt(e.target.value)})} className="w-full border p-1 rounded"/></label>
                    <label className="text-sm">Color<input type="color" value={stroke.color} onChange={e=>setStroke({...stroke,color:e.target.value})} className="w-full border p-1 rounded"/></label>
                  </div>}
                </div>

                {/* Sideline */}
                <div className="bg-white p-3 rounded shadow">
                  <label className="flex items-center">
                    <input type="checkbox" checked={sideline.show} onChange={e=>setSideline({...sideline,show:e.target.checked})}/>
                    <span className="ml-2">Show sideline</span>
                  </label>
                  {sideline.show && <>
                    <label className="block text-sm">Width<input type="number" value={sideline.width} onChange={e=>setSideline({...sideline,width:parseInt(e.target.value)})} className="w-full border p-1 rounded"/></label>
                    <label className="block text-sm">Gap<input type="number" value={sideline.gap} onChange={e=>setSideline({...sideline,gap:parseInt(e.target.value)})} className="w-full border p-1 rounded"/></label>
                    <label className="block text-sm">Height<input type="number" value={sideline.height} onChange={e=>setSideline({...sideline,height:parseInt(e.target.value)})} className="w-full border p-1 rounded"/></label>
                    <label className="block text-sm">Color<input type="color" value={sideline.color} onChange={e=>setSideline({...sideline,color:e.target.value})} className="w-full border p-1 rounded"/></label>
                    <label className="block text-sm">Transparency<input type="range" min="0" max="1" step="0.05" value={sideline.opacity} onChange={e=>setSideline({...sideline,opacity:parseFloat(e.target.value)})} className="w-full"/></label>
                    <label className="block text-sm">Vertical offset<input type="number" value={sidelineOffset} onChange={e=>setSidelineOffset(parseInt(e.target.value))} className="w-full border p-1 rounded mt-1"/></label>
                  </>}
                </div>

                {/* Upload images */}
                <div className="bg-white p-3 rounded shadow">
                  <label className="block text-sm font-medium">Upload images</label>
                  <input type="file" accept="image/*" multiple onChange={onImageUpload} className="mt-2"/>
                </div>

                {/* Per-image controls */}
                {images.map(img=>(
                 <div key={img.id} className={`bg-white p-3 rounded shadow space-y-1 ${activeImageId === img.id ? 'border-2 border-blue-500' : ''}`}>

                    <div className="flex justify-between items-center">
                      <span className="text-sm">Image {img.id}</span>
                      <button onClick={()=>deleteImage(img.id)} className="text-red-500 text-sm">Delete</button>
                    </div>
                    <label className="block text-sm">Zoom</label>
                   <input type="range" min="0.1" max="3" step="0.05"        value={img.scale}        onChange={e => changeImageScale(img.id, parseFloat(e.target.value))}
       className={`w-full ${activeImageId === img.id ? 'border-blue-500' : ''}`} />

                    <div className="flex gap-2 mt-1">
                      <button onClick={()=>bringForward(img.id)} className="bg-gray-200 px-2 py-1 rounded text-sm">Bring Forward</button>
                      <button onClick={()=>sendBackward(img.id)} className="bg-gray-200 px-2 py-1 rounded text-sm">Send Backward</button>
                    </div>
                  </div>
                ))}

                {/* Logo */}
                <div className="bg-white p-3 rounded shadow">
                  <label className="flex items-center">
                    <input type="checkbox" checked={logo.show} onChange={e=>setLogo({...logo,show:e.target.checked})}/>
                    <span className="ml-2">Show Logo</span>
                  </label>
                  {logo.show &&
                    <select value={logo.position} onChange={e=>setLogo({...logo,position:e.target.value})} className="w-full border p-1 rounded mt-2">
                      <option value="top-left">Top Left</option>
                      <option value="top-right">Top Right</option>
                      <option value="bottom-left">Bottom Left</option>
                      <option value="bottom-right">Bottom Right</option>
                    </select>
                  }
                </div>
				
				{/* Canvas presets */}
<div className="bg-white p-3 rounded shadow">
  <label className="block text-sm font-medium">Canvas size</label>
  <div className="flex gap-2 mt-2 flex-wrap">
    <button
      onClick={() => { setWidth(1080); setHeight(1080); }}
      className="bg-gray-200 px-3 py-1 rounded"
    >
      Instagram Square
    </button>
    <button
      onClick={() => { setWidth(1080); setHeight(1920); }}
      className="bg-gray-200 px-3 py-1 rounded"
    >
      Instagram Story
    </button>
    <button
      onClick={() => { setWidth(1200); setHeight(720); }}
      className="bg-gray-200 px-3 py-1 rounded"
    >
      YouTube
    </button>
  </div>
</div>


                {/* Canvas & File */}
                <div className="bg-white p-3 rounded shadow space-y-2">
                  <label className="block text-sm">File name</label>
                  <input type="text" value={fileName} onChange={e=>setFileName(e.target.value)} className="w-full border p-1 rounded"/>
                  <label className="block text-sm">Fit mode</label>
                  <select value={fitMode} onChange={e=>setFitMode(e.target.value)} className="w-full border p-1 rounded">
                    <option value="cover">Cover</option>
                    <option value="contain">Contain</option>
                    <option value="stretch">Stretch</option>
                  </select>
                  <button onClick={exportAsImage} className="w-full bg-blue-600 text-white py-2 rounded mt-2">Export PNG</button>
                </div>
              </div>

              {/* Preview */}
              <div className="flex-1">
                <div className="sticky top-4">
                  <div className="mb-2">Preview (Output size: {width}Ã—{height})</div>
                  <div ref={containerRef} className="relative mx-auto bg-black overflow-auto" style={{width,height}}>
                    {/* Images */}
                    {images.sort((a,b)=>a.zIndex-b.zIndex).map(img=>(
<img key={img.id} src={img.src} 
     onMouseDown={e => startDragImage(e, img.id)}
     onTouchStart={e => startDragImage(e, img.id)}
     onTouchMove={e => handlePinchZoom(e, img.id)}
     onTouchEnd={e => resetPinchZoom(img.id)}
     style={{
       position:"absolute",
       left:img.x,
       top:img.y,
       transform:`scale(${img.scale})`,
       cursor:"grab",
       width:fitMode==="stretch"?"100%":"auto",
       height:fitMode==="stretch"?"100%":"auto",
       maxWidth:fitMode!=="stretch"?"none":"100%",
       maxHeight:fitMode!=="stretch"?"none":"100%",
       border: activeImageId === img.id ? '2px solid #3b82f6' : 'none'
     }}
/>
			  
))}


                    {/* Sideline */}
                    {sideline.show && <div className="sideline-clone" style={{
                      position:"absolute",
                      [direction==="ltr"?"left":"right"]:sideline.gap,
                      top:textPos.y+sidelineOffset,
                      height:sideline.height||textRef.current?.offsetHeight||0,
                      width:sideline.width,
                      background:sideline.color,
                      opacity:sideline.opacity
                    }}/>}

                    {/* Logo */}
                    {logo.show && <img src="sabah-logo.PNG" alt="Logo" style={{position:"absolute", width:120,height:60,
                      ...(logo.position==="top-left"?{left:30,top:150}:{})
                      ,...(logo.position==="top-right"?{right:30,top:150}:{})
                      ,...(logo.position==="bottom-left"?{left:30,bottom:150}:{})
                      ,...(logo.position==="bottom-right"?{right:30,bottom:150}:{})
                    }}/>}
                    
                    {/* Headline */}
                    <div ref={textRef} onMouseDown={startDragText} dir={direction} style={{
                      position:"absolute", left:textPos.x, top:textPos.y,
                      fontSize,lineHeight,fontFamily,color:textColor,
                      textShadow: shadow.enabled?`${shadow.offsetX}px ${shadow.offsetY}px ${shadow.blur}px ${shadow.color}`:"none",
                      WebkitTextStroke: stroke.enabled?`${stroke.width}px ${stroke.color}`:"none",
                      whiteSpace:"pre-wrap", cursor:"move"
                    }}>{headline}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        )
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<SocialCardGenerator />);
// --- Dragging Image (mouse + touch)
function startDragImage(e, id) {
  e.preventDefault();
  selectImage(id);
  const img = images.find(im => im.id === id);
  const initX = img.x, initY = img.y;
  const maxZ = Math.max(...images.map(im => im.zIndex));
  setImages((imgs) => imgs.map(im => im.id === id ? {...im, zIndex: maxZ+1} : im));

  let startX = e.clientX, startY = e.clientY;
  if (e.touches) { // touch event
    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
  }

  function onMove(ev) {
    let currentX = ev.clientX, currentY = ev.clientY;
    if (ev.touches) {
      currentX = ev.touches[0].clientX;
      currentY = ev.touches[0].clientY;
    }
    setImages((imgs) => imgs.map(im => im.id === id ? {...im, x: initX + currentX - startX, y: initY + currentY - startY} : im));
  }

  function onUp() {
    window.removeEventListener("mousemove", onMove);
    window.removeEventListener("mouseup", onUp);
    window.removeEventListener("touchmove", onMove);
    window.removeEventListener("touchend", onUp);
  }

  window.addEventListener("mousemove", onMove);
  window.addEventListener("mouseup", onUp);
  window.addEventListener("touchmove", onMove, {passive:false});
  window.addEventListener("touchend", onUp);
}

// --- Dragging Text (mouse + touch)
function startDragText(e) {
  e.preventDefault();
  const initPos = {...textPos};
  let startX = e.clientX, startY = e.clientY;
  if (e.touches) { startX = e.touches[0].clientX; startY = e.touches[0].clientY; }

  function onMove(ev){
    let currentX = ev.clientX, currentY = ev.clientY;
    if (ev.touches) { currentX = ev.touches[0].clientX; currentY = ev.touches[0].clientY; }
    setTextPos({x: initPos.x + currentX - startX, y: initPos.y + currentY - startY});
  }

  function onUp(){
    window.removeEventListener("mousemove", onMove);
    window.removeEventListener("mouseup", onUp);
    window.removeEventListener("touchmove", onMove);
    window.removeEventListener("touchend", onUp);
  }

  window.addEventListener("mousemove", onMove);
  window.addEventListener("mouseup", onUp);
  window.addEventListener("touchmove", onMove, {passive:false});
  window.addEventListener("touchend", onUp);
}

// --- Pinch Zoom for Images ---
function handlePinchZoom(e, id) {
  if (e.touches && e.touches.length === 2) {
    e.preventDefault();
    const [touch1, touch2] = e.touches;
    const dist = Math.hypot(touch2.clientX - touch1.clientX, touch2.clientY - touch1.clientY);
    if (!images.find(im => im.id === id).initialDistance) {
      setImages(imgs => imgs.map(im => im.id === id ? {...im, initialDistance: dist, initialScale: im.scale} : im));
      return;
    }
    const img = images.find(im => im.id === id);
    const newScale = img.initialScale * (dist / img.initialDistance);
    changeImageScale(id, newScale);
  }
}

function resetPinchZoom(id) {
  setImages(imgs => imgs.map(im => im.id === id ? {...im, initialDistance: null, initialScale: null} : im));
}
		
    </script>
  </body>
</html>
