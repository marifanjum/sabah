<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Social Card Generator</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    .draggable {
      cursor: move;
      user-select: none;
    }
  </style>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    function SocialCardGenerator() {
      const [image, setImage] = useState(null);
      const [scale, setScale] = useState(1);
      const [offset, setOffset] = useState({ x: 0, y: 0 });
      const [dragging, setDragging] = useState(false);
      const [startPos, setStartPos] = useState(null);

      const [headline, setHeadline] = useState("Your headline here");
      const [headlinePos, setHeadlinePos] = useState({ x: 50, y: 50 });
      const [headlineDragging, setHeadlineDragging] = useState(false);
      const [headlineStart, setHeadlineStart] = useState(null);

      const [fontSize, setFontSize] = useState(32);
      const [lineHeight, setLineHeight] = useState(1.2);
      const [textColor, setTextColor] = useState("#000000");
      const [shadow, setShadow] = useState(false);
      const [shadowColor, setShadowColor] = useState("#000000");
      const [shadowBlur, setShadowBlur] = useState(4);
      const [shadowOffsetX, setShadowOffsetX] = useState(2);
      const [shadowOffsetY, setShadowOffsetY] = useState(2);

      const [sideline, setSideline] = useState(false);
      const [sidelineColor, setSidelineColor] = useState("#000000");
      const [sidelineWidth, setSidelineWidth] = useState(4);
      const [sidelineGap, setSidelineGap] = useState(8);

      const [fitMode, setFitMode] = useState("cover");
      const [canvasSize, setCanvasSize] = useState({ w: 1080, h: 1080 });

      const [fontFamily, setFontFamily] = useState("Jameel Noori Nastaleeq");
      const [direction, setDirection] = useState("ltr");

      const [filename, setFilename] = useState("social-card");

      const [showLogo, setShowLogo] = useState(false);
      const [logoPosition, setLogoPosition] = useState("bottom-right");

      const canvasRef = useRef();

      const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (ev) => setImage(ev.target.result);
          reader.readAsDataURL(file);
        }
      };

      const handleMouseDown = (e) => {
        setDragging(true);
        setStartPos({ x: e.clientX, y: e.clientY, ox: offset.x, oy: offset.y });
      };
      const handleMouseMove = (e) => {
        if (dragging) {
          const dx = e.clientX - startPos.x;
          const dy = e.clientY - startPos.y;
          setOffset({ x: startPos.ox + dx, y: startPos.oy + dy });
        }
      };
      const handleMouseUp = () => setDragging(false);

      const handleHeadlineDown = (e) => {
        e.stopPropagation();
        setHeadlineDragging(true);
        setHeadlineStart({ x: e.clientX, y: e.clientY, ox: headlinePos.x, oy: headlinePos.y });
      };
      const handleHeadlineMove = (e) => {
        if (headlineDragging) {
          const dx = e.clientX - headlineStart.x;
          const dy = e.clientY - headlineStart.y;
          setHeadlinePos({ x: headlineStart.ox + dx, y: headlineStart.oy + dy });
        }
      };
      const handleHeadlineUp = () => setHeadlineDragging(false);

      useEffect(() => {
        window.addEventListener("mousemove", handleMouseMove);
        window.addEventListener("mouseup", handleMouseUp);
        window.addEventListener("mousemove", handleHeadlineMove);
        window.addEventListener("mouseup", handleHeadlineUp);
        return () => {
          window.removeEventListener("mousemove", handleMouseMove);
          window.removeEventListener("mouseup", handleMouseUp);
          window.removeEventListener("mousemove", handleHeadlineMove);
          window.removeEventListener("mouseup", handleHeadlineUp);
        };
      });

      const exportImage = () => {
        const canvas = document.createElement("canvas");
        canvas.width = canvasSize.w;
        canvas.height = canvasSize.h;
        const ctx = canvas.getContext("2d");

        if (image) {
          const img = new Image();
          img.src = image;
          img.onload = () => {
            let iw = img.width, ih = img.height;
            let cw = canvas.width, ch = canvas.height;
            let sx=0, sy=0, sw=iw, sh=ih;

            if (fitMode === "cover") {
              const scale = Math.max(cw / iw, ch / ih);
              sw = cw / scale;
              sh = ch / scale;
              sx = (iw - sw) / 2;
              sy = (ih - sh) / 2;
              ctx.drawImage(img, sx, sy, sw, sh, 0, 0, cw, ch);
            } else if (fitMode === "contain") {
              const scale = Math.min(cw / iw, ch / ih);
              const nw = iw * scale;
              const nh = ih * scale;
              const nx = (cw - nw) / 2;
              const ny = (ch - nh) / 2;
              ctx.drawImage(img, 0, 0, iw, ih, nx, ny, nw, nh);
            } else {
              ctx.drawImage(img, 0, 0, cw, ch);
            }

            drawOverlay(ctx);
          };
        } else {
          drawOverlay(ctx);
        }

        function drawOverlay(ctx) {
          ctx.save();
          ctx.font = fontSize + "px '" + fontFamily + "', Inter, sans-serif";
          ctx.fillStyle = textColor;
          ctx.textAlign = "left";
          ctx.textBaseline = "top";
          ctx.direction = direction;

          if (shadow) {
            ctx.shadowColor = shadowColor;
            ctx.shadowBlur = shadowBlur;
            ctx.shadowOffsetX = shadowOffsetX;
            ctx.shadowOffsetY = shadowOffsetY;
          }

          let x = headlinePos.x;
          let y = headlinePos.y;

          if (sideline) {
            const lineX = direction === "rtl" ? x + ctx.measureText(headline).width + sidelineGap : x - sidelineGap - sidelineWidth;
            ctx.fillStyle = sidelineColor;
            ctx.fillRect(lineX, y, sidelineWidth, fontSize * lineHeight * 2);
            ctx.fillStyle = textColor;
          }

          ctx.fillText(headline, x, y);

          ctx.restore();

          if (showLogo) {
            const logo = new Image();
            logo.src = "sabah-logo.PNG";
            logo.onload = () => {
              const margin = 16;
              const logoSize = 100;
              let lx = 0, ly = 0;
              if (logoPosition === "top-left") {
                lx = margin; ly = margin;
              } else if (logoPosition === "top-right") {
                lx = canvas.width - logoSize - margin; ly = margin;
              } else if (logoPosition === "bottom-left") {
                lx = margin; ly = canvas.height - logoSize - margin;
              } else {
                lx = canvas.width - logoSize - margin; ly = canvas.height - logoSize - margin;
              }
              ctx.drawImage(logo, lx, ly, logoSize, logoSize);
              saveFile();
            };
          } else {
            saveFile();
          }
        }

        function saveFile() {
          const link = document.createElement("a");
          link.download = filename + ".png";
          link.href = canvas.toDataURL("image/png");
          link.click();
        }
      };

      return (
        <div className="flex flex-col md:flex-row p-4 gap-4">
          <div className="flex-1 flex items-center justify-center bg-white shadow rounded relative overflow-hidden"
            style={{ width: canvasSize.w/4, height: canvasSize.h/4 }}
            onMouseDown={handleMouseDown}
          >
            {image && (
              <img
                src={image}
                alt="background"
                style={{
                  transform: `translate(${offset.x}px, ${offset.y}px) scale(${scale})`,
                  objectFit: fitMode
                }}
              />
            )}
            <div
              className="absolute draggable"
              onMouseDown={handleHeadlineDown}
              style={{
                left: headlinePos.x,
                top: headlinePos.y,
                fontSize: fontSize,
                lineHeight: lineHeight,
                color: textColor,
                fontFamily: fontFamily + ", Inter, sans-serif",
                direction: direction,
                textShadow: shadow
                  ? `${shadowOffsetX}px ${shadowOffsetY}px ${shadowBlur}px ${shadowColor}`
                  : "none",
              }}
            >
              {sideline && (
                <div
                  style={{
                    backgroundColor: sidelineColor,
                    width: sidelineWidth,
                    height: "100%",
                    display: "inline-block",
                    marginRight: direction === "ltr" ? sidelineGap : 0,
                    marginLeft: direction === "rtl" ? sidelineGap : 0,
                  }}
                />
              )}
              {headline}
            </div>
            {showLogo && (
              <img
                src="sabah-logo.PNG"
                alt="logo"
                style={{
                  position: "absolute",
                  width: "60px",
                  ...(logoPosition === "top-left" && { top: "8px", left: "8px" }),
                  ...(logoPosition === "top-right" && { top: "8px", right: "8px" }),
                  ...(logoPosition === "bottom-left" && { bottom: "8px", left: "8px" }),
                  ...(logoPosition === "bottom-right" && { bottom: "8px", right: "8px" }),
                }}
              />
            )}
          </div>

          <div className="w-full md:w-80 flex flex-col gap-2">
            <input type="file" onChange={handleImageUpload} className="mb-2" />
            <textarea value={headline} onChange={(e)=>setHeadline(e.target.value)} className="border p-2" />
            <label>Font Size <input type="number" value={fontSize} onChange={(e)=>setFontSize(parseInt(e.target.value))} className="w-20 border ml-2" /></label>
            <label>Line Height <input type="number" step="0.1" value={lineHeight} onChange={(e)=>setLineHeight(parseFloat(e.target.value))} className="w-20 border ml-2" /></label>
            <label>Text Color <input type="color" value={textColor} onChange={(e)=>setTextColor(e.target.value)} /></label>

            <label>Font Family
              <select value={fontFamily} onChange={(e)=>setFontFamily(e.target.value)} className="border ml-2">
                <option>Jameel Noori Nastaleeq</option>
                <option>Pangea</option>
                <option>Inter</option>
              </select>
            </label>

            <label>Text Direction
              <select value={direction} onChange={(e)=>setDirection(e.target.value)} className="border ml-2">
                <option value="ltr">LTR</option>
                <option value="rtl">RTL</option>
              </select>
            </label>

            <label><input type="checkbox" checked={shadow} onChange={(e)=>setShadow(e.target.checked)} /> Shadow</label>
            {shadow && (
              <div className="pl-4 flex flex-col gap-1">
                <label>Shadow Color <input type="color" value={shadowColor} onChange={(e)=>setShadowColor(e.target.value)} /></label>
                <label>Blur <input type="number" value={shadowBlur} onChange={(e)=>setShadowBlur(parseInt(e.target.value))} className="w-20 border ml-2" /></label>
                <label>OffsetX <input type="number" value={shadowOffsetX} onChange={(e)=>setShadowOffsetX(parseInt(e.target.value))} className="w-20 border ml-2" /></label>
                <label>OffsetY <input type="number" value={shadowOffsetY} onChange={(e)=>setShadowOffsetY(parseInt(e.target.value))} className="w-20 border ml-2" /></label>
              </div>
            )}

            <label><input type="checkbox" checked={sideline} onChange={(e)=>setSideline(e.target.checked)} /> Sideline</label>
            {sideline && (
              <div className="pl-4 flex flex-col gap-1">
                <label>Line Color <input type="color" value={sidelineColor} onChange={(e)=>setSidelineColor(e.target.value)} /></label>
                <label>Width <input type="number" value={sidelineWidth} onChange={(e)=>setSidelineWidth(parseInt(e.target.value))} className="w-20 border ml-2" /></label>
                <label>Gap <input type="number" value={sidelineGap} onChange={(e)=>setSidelineGap(parseInt(e.target.value))} className="w-20 border ml-2" /></label>
              </div>
            )}

            <label>Fit Mode
              <select value={fitMode} onChange={(e)=>setFitMode(e.target.value)} className="border ml-2">
                <option value="cover">Cover</option>
                <option value="contain">Contain</option>
                <option value="stretch">Stretch</option>
              </select>
            </label>

            <label>Canvas Size
              <select onChange={(e)=>{
                if(e.target.value==="square") setCanvasSize({w:1080,h:1080});
                else setCanvasSize({w:1080,h:1920});
              }} className="border ml-2">
                <option value="square">Instagram Square</option>
                <option value="story">Instagram Story</option>
              </select>
            </label>

            <label>Export Filename
              <input type="text" value={filename} onChange={(e)=>setFilename(e.target.value)} className="border ml-2" />
            </label>

            <label><input type="checkbox" checked={showLogo} onChange={(e)=>setShowLogo(e.target.checked)} /> Show Logo</label>
            {showLogo && (
              <label>Logo Position
                <select value={logoPosition} onChange={(e)=>setLogoPosition(e.target.value)} className="border ml-2">
                  <option value="top-left">Top Left</option>
                  <option value="top-right">Top Right</option>
                  <option value="bottom-left">Bottom Left</option>
                  <option value="bottom-right">Bottom Right</option>
                </select>
              </label>
            )}

            <button onClick={exportImage} className="bg-blue-600 text-white p-2 rounded mt-2">Export PNG</button>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<SocialCardGenerator />);
  </script>
</body>
</html>
