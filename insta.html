<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Social Card Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    @font-face {
      font-family: "Pangea Afrikan Trial";
      src: url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.eot");
      src: url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.eot?#iefix") format("embedded-opentype"),
           url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.woff2") format("woff2"),
           url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.woff") format("woff"),
           url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.ttf") format("truetype"),
           url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.svg#Pangea Afrikan Trial") format("svg");
    }
  </style>
</head>
<body class="bg-gray-100">
<div id="root"></div>

<script type="text/babel">
function SocialCardGenerator() {
  const { useState, useRef } = React;
  const containerRef = useRef(null);

  // --- Images ---
  const [images, setImages] = useState([]);
  const [activeImageId, setActiveImageId] = useState(null);

  // --- Canvas ---
  const [width, setWidth] = useState(1200);
  const [height, setHeight] = useState(720);
  const [fileName, setFileName] = useState("social-card");
  const [fitMode, setFitMode] = useState("cover");

  // --- Logo ---
  const [logo, setLogo] = useState({ show: true, position: "top-right" });

  // --- Headlines ---
  const [headlines, setHeadlines] = useState([
    {
      id: Date.now(),
      text: "Headline 1",
      fontSize: 72,
      lineHeight: 1.2,
      fontFamily: "Jameel Noori Nastaleeq",
      color: "#ffffff",
      x: 100,
      y: 200,
      direction: "rtl",
      shadow: { enabled: true, offsetX: 2, offsetY: 2, blur: 6, color: "rgba(0,0,0,0.6)" },
      stroke: { enabled: false, width: 1, color: "#000000" },
      sidelineOffset: 0,
      sideline: { show: true, width: 4, gap: 8, color: "#ff0000", opacity: 1 },
      collapsed: false
    }
  ]);

  // --- Headline update utility ---
  function updateHeadline(id, prop, value) {
    setHeadlines(hs => hs.map(h => h.id === id ? { ...h, [prop]: value } : h));
  }

  // --- Drag headline ---
  function startDragHeadline(e, id) {
    e.preventDefault();
    const startX = e.clientX, startY = e.clientY;
    const h = headlines.find(h => h.id === id);
    const initPos = { x: h.x, y: h.y };

    function onMove(ev) {
      setHeadlines(hs => hs.map(h => h.id===id?{...h,x:initPos.x+ev.clientX-startX,y:initPos.y+ev.clientY-startY}:h));
    }
    function onUp() { window.removeEventListener("mousemove", onMove); window.removeEventListener("mouseup", onUp);}
    window.addEventListener("mousemove", onMove);
    window.addEventListener("mouseup", onUp);
  }

  // --- Images ---
  function onImageUpload(e) {
    const files = e.target.files;
    if (!files) return;
    const newImages = Array.from(files).map((file,index)=>({
      id: Date.now()+index,
      src: URL.createObjectURL(file),
      x:0,y:0,scale:1,zIndex:images.length+index
    }));
    setImages([...images,...newImages]);
  }
  function changeImageScale(id, scale){ setImages(imgs=>imgs.map(im=>im.id===id?{...im,scale}:im)) }
  function bringForward(id){ const maxZ=Math.max(...images.map(im=>im.zIndex)); setImages(imgs=>imgs.map(im=>im.id===id?{...im,zIndex:maxZ+1}:im)) }
  function sendBackward(id){ const minZ=Math.min(...images.map(im=>im.zIndex)); setImages(imgs=>imgs.map(im=>im.id===id?{...im,zIndex:minZ-1}:im)) }
  function deleteImage(id){ setImages(imgs=>imgs.filter(im=>im.id!==id)) }
  function selectImage(id){ setActiveImageId(id); const maxZ=Math.max(...images.map(im=>im.zIndex)); setImages(imgs=>imgs.map(im=>im.id===id?{...im,zIndex:maxZ+1}:im)) }
  function startDragImage(e,id){ e.preventDefault(); const startX=e.clientX,startY=e.clientY; const img=images.find(im=>im.id===id); const initX=img.x,initY=img.y; const maxZ=Math.max(...images.map(im=>im.zIndex)); setImages(imgs=>imgs.map(im=>im.id===id?{...im,zIndex:maxZ+1}:im)); function onMove(ev){ setImages(imgs=>imgs.map(im=>im.id===id?{...im,x:initX+ev.clientX-startX,y:initY+ev.clientY-startY}:im)) } function onUp(){window.removeEventListener("mousemove",onMove);window.removeEventListener("mouseup",onUp);} window.addEventListener("mousemove",onMove); window.addEventListener("mouseup",onUp); }

  // --- Export ---
  function exportAsImage() {
    if(!containerRef.current) return;
    html2canvas(containerRef.current,{useCORS:true}).then(canvas=>{
      const link=document.createElement("a");
      link.download=(fileName && fileName.trim()?fileName.trim():"social-card")+".png";
      link.href=canvas.toDataURL("image/png");
      link.click();
    });
  }

  return (
    <div className="p-4 max-w-7xl mx-auto">
      <div className="flex gap-6">
        {/* Controls */}
        <div className="w-96 space-y-4">
          <h2 className="text-xl font-semibold">Controls</h2>

          {/* Headlines */}
          {headlines.map(h=>(
            <div key={h.id} className="bg-white p-2 rounded shadow">
              <div className="flex justify-between items-center cursor-pointer" onClick={()=>updateHeadline(h.id,'collapsed',!h.collapsed)}>
                <span className="font-medium">Headline {h.id}</span>
                <span>{h.collapsed?'▼':'▲'}</span>
              </div>
              {!h.collapsed && (
                <div className="space-y-2 mt-2">
                  <textarea value={h.text} onChange={e=>updateHeadline(h.id,'text',e.target.value)} className="w-full border p-1 rounded"/>
                  <input type="number" value={h.fontSize} onChange={e=>updateHeadline(h.id,'fontSize',parseInt(e.target.value))} className="w-full border p-1 rounded"/>
                  <input type="color" value={h.color} onChange={e=>updateHeadline(h.id,'color',e.target.value)} />
                  <input type="number" step="0.1" value={h.lineHeight} onChange={e=>updateHeadline(h.id,'lineHeight',parseFloat(e.target.value))} className="w-full border p-1 rounded"/>
                  <select value={h.fontFamily} onChange={e=>updateHeadline(h.id,'fontFamily',e.target.value)} className="w-full border p-1 rounded">
                    <option value="Jameel Noori Nastaleeq">Jameel Noori Nastaleeq</option>
                    <option value="Pangea Afrikan Trial">Pangea</option>
                    <option value="Tahoma">Tahoma</option>
                    <option value="Arial">Arial</option>
                  </select>
                  <select value={h.direction} onChange={e=>updateHeadline(h.id,'direction',e.target.value)} className="w-full border p-1 rounded">
                    <option value="ltr">LTR</option>
                    <option value="rtl">RTL</option>
                  </select>

                  {/* Shadow */}
                  <div className="mt-1 border-t pt-1">
                    <label className="flex items-center"><input type="checkbox" checked={h.shadow.enabled} onChange={e=>updateHeadline(h.id,'shadow',{...h.shadow,enabled:e.target.checked})}/> <span className="ml-2">Shadow</span></label>
                    {h.shadow.enabled && <div className="grid grid-cols-2 gap-1 mt-1">
                      <input type="number" value={h.shadow.offsetX} onChange={e=>updateHeadline(h.id,'shadow',{...h.shadow,offsetX:parseInt(e.target.value)})} placeholder="OffsetX" className="border p-1 rounded"/>
                      <input type="number" value={h.shadow.offsetY} onChange={e=>updateHeadline(h.id,'shadow',{...h.shadow,offsetY:parseInt(e.target.value)})} placeholder="OffsetY" className="border p-1 rounded"/>
                      <input type="number" value={h.shadow.blur} onChange={e=>updateHeadline(h.id,'shadow',{...h.shadow,blur:parseInt(e.target.value)})} placeholder="Blur" className="border p-1 rounded"/>
                      <input type="color" value={h.shadow.color} onChange={e=>updateHeadline(h.id,'shadow',{...h.shadow,color:e.target.value})}/>
                    </div>}
                  </div>

                  {/* Stroke */}
                  <div className="mt-1 border-t pt-1">
                    <label className="flex items-center"><input type="checkbox" checked={h.stroke.enabled} onChange={e=>updateHeadline(h.id,'stroke',{...h.stroke,enabled:e.target.checked})}/> <span className="ml-2">Stroke</span></label>
                    {h.stroke.enabled && <div className="grid grid-cols-2 gap-1 mt-1">
                      <input type="number" value={h.stroke.width} onChange={e=>updateHeadline(h.id,'stroke',{...h.stroke,width:parseInt(e.target.value)})} placeholder="Width" className="border p-1 rounded"/>
                      <input type="color" value={h.stroke.color} onChange={e=>updateHeadline(h.id,'stroke',{...h.stroke,color:e.target.value})}/>
                    </div>}
                  </div>

                  {/* Sideline */}
                  <div className="mt-1 border-t pt-1">
                    <label className="flex items-center"><input type="checkbox" checked={h.sideline.show} onChange={e=>updateHeadline(h.id,'sideline',{...h.sideline,show:e.target.checked})}/> <span className="ml-2">Sideline</span></label>
                    {h.sideline.show && <div className="grid grid-cols-2 gap-1 mt-1">
                      <input type="number" value={h.sideline.width} onChange={e=>updateHeadline(h.id,'sideline',{...h.sideline,width:parseInt(e.target.value)})} placeholder="Width" className="border p-1 rounded"/>
                      <input type="number" value={h.sideline.gap} onChange={e=>updateHeadline(h.id,'sideline',{...h.sideline,gap:parseInt(e.target.value)})} placeholder="Gap" className="border p-1 rounded"/>
                      <input type="color" value={h.sideline.color} onChange={e=>updateHeadline(h.id,'sideline',{...h.sideline,color:e.target.value})}/>
                      <input type="range" min="0" max="1" step="0.05" value={h.sideline.opacity} onChange={e=>updateHeadline(h.id,'sideline',{...h.sideline,opacity:parseFloat(e.target.value)})}/>
                      <input type="number" value={h.sidelineOffset} onChange={e=>updateHeadline(h.id,'sidelineOffset',parseInt(e.target.value))} placeholder="Vertical offset" className="border p-1 rounded"/>
                    </div>}
                  </div>

                  <button onClick={()=>setHeadlines(headlines.filter(x=>x.id!==h.id))} className="w-full bg-red-500 text-white py-1 rounded mt-1">Delete Headline</button>
                </div>
              )}
            </div>
          ))}

          <button onClick={()=>setHeadlines([...headlines,{
            id:Date.now(),
            text:"New Headline",
            fontSize:72,
            lineHeight:1.2,
            fontFamily:"Jameel Noori Nastaleeq",
            color:"#ffffff",
            x:100,y:200,
            direction:"rtl",
            shadow:{enabled:true,offsetX:2,offsetY:2,blur:6,color:"rgba(0,0,0,0.6)"},
            stroke:{enabled:false,width:1,color:"#000000"},
            sidelineOffset:0,
            sideline:{show:true,width:4,gap:8,color:"#ff0000",opacity:1},
            collapsed:false
          }])} className="w-full bg-green-600 text-white py-2 rounded mt-2">Add Headline</button>

          {/* Images, Logo, Canvas Presets, Export */}
          <div className="bg-white p-3 rounded shadow mt-2">
            <label>Upload Images</label>
            <input type="file" accept="image/*" multiple onChange={onImageUpload} className="mt-1"/>
          </div>

          <div className="bg-white p-3 rounded shadow mt-2">
            <label>Show Logo</label>
            <input type="checkbox" checked={logo.show} onChange={e=>setLogo({...logo,show:e.target.checked})} className="ml-2"/>
            <select value={logo.position} onChange={e=>setLogo({...logo,position:e.target.value})} className="w-full mt-1 border p-1 rounded">
              <option value="top-left">Top Left</option>
              <option value="top-right">Top Right</option>
              <option value="bottom-left">Bottom Left</option>
              <option value="bottom-right">Bottom Right</option>
            </select>
          </div>

          <div className="bg-white p-3 rounded shadow mt-2">
            <label>Canvas Presets</label>
            <div className="flex gap-2 mt-1 flex-wrap">
              <button onClick={()=>{setWidth(1080); setHeight(1080)}} className="bg-gray-200 px-3 py-1 rounded">Square</button>
              <button onClick={()=>{setWidth(1080); setHeight(1920)}} className="bg-gray-200 px-3 py-1 rounded">Story</button>
              <button onClick={()=>{setWidth(1200); setHeight(720)}} className="bg-gray-200 px-3 py-1 rounded">YouTube</button>
            </div>
          </div>

          <div className="bg-white p-3 rounded shadow mt-2 space-y-2">
            <label>File Name</label>
            <input type="text" value={fileName} onChange={e=>setFileName(e.target.value)} className="w-full border p-1 rounded"/>
            <label>Fit Mode</label>
            <select value={fitMode} onChange={e=>setFitMode(e.target.value)} className="w-full border p-1 rounded">
              <option value="cover">Cover</option>
              <option value="contain">Contain</option>
              <option value="stretch">Stretch</option>
            </select>
            <button onClick={exportAsImage} className="w-full bg-blue-600 text-white py-2 rounded mt-2">Export PNG</button>
          </div>

        </div>

        {/* Preview */}
        <div className="flex-1">
          <div className="sticky top-4">
            <div className="mb-2">Preview ({width}×{height})</div>
            <div ref={containerRef} className="relative mx-auto bg-black overflow-auto" style={{width,height}}>
              {images.sort((a,b)=>a.zIndex-b.zIndex).map(img=>(
                <img key={img.id} src={img.src} onMouseDown={e=>{startDragImage(e,img.id); selectImage(img.id);}}
                     style={{
                       position:"absolute",
                       left:img.x, top:img.y,
                       transform:`scale(${img.scale})`,
                       cursor:"grab",
                       width: fitMode==="stretch"?"100%":"auto",
                       height: fitMode==="stretch"?"100%":"auto",
                       maxWidth: fitMode!=="stretch"?"none":"100%",
                       maxHeight: fitMode!=="stretch"?"none":"100%",
                       border: activeImageId===img.id?'2px solid #3b82f6':'none'
                     }}
                />
              ))}

              {headlines.map(h=>(
                <div key={h.id} onMouseDown={e=>startDragHeadline(e,h.id)}
                     style={{
                       position:"absolute",
                       left:h.x, top:h.y,
                       fontSize:h.fontSize,
                       lineHeight:h.lineHeight,
                       fontFamily:h.fontFamily,
                       color:h.color,
                       cursor:"move",
                       textShadow:h.shadow.enabled?`${h.shadow.offsetX}px ${h.shadow.offsetY}px ${h.shadow.blur}px ${h.shadow.color}`:"none",
                       WebkitTextStroke:h.stroke.enabled?`${h.stroke.width}px ${h.stroke.color}`:"none",
                       whiteSpace:"pre-wrap"
                     }}
                     dir={h.direction}
                >
                  {h.text}
                </div>
              ))}

              {logo.show && <img src="sabah-logo.PNG" alt="Logo" style={{
                position:"absolute", width:120,height:60,
                ...(logo.position==="top-left"?{left:30,top:150}:{})
                ,...(logo.position==="top-right"?{right:30,top:150}:{})
                ,...(logo.position==="bottom-left"?{left:30,bottom:150}:{})
                ,...(logo.position==="bottom-right"?{right:30,bottom:150}:{})
              }}/>}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<SocialCardGenerator />);
</script>
</body>
</html>
