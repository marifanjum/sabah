<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Social Media Card Generator</title>
  <style>
    body { font-family: Arial, sans-serif; display: flex; gap: 20px; }
    #controls { width: 300px; overflow-y: auto; max-height: 95vh; }
    #canvas-container { border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; }
    #preview { position: relative; overflow: hidden; background: #eee; }
    #bg-image { position: absolute; top: 0; left: 0; transform-origin: center; cursor: grab; }
    #headline { position: absolute; font-size: 32px; cursor: move; white-space: pre-wrap; }
    #headline.with-sidebar { display: flex; align-items: flex-start; }
    #headline.with-sidebar .sidebar { width: 5px; background: currentColor; margin-inline-end: 10px; }
    #logo { position: absolute; max-width: 100px; max-height: 100px; }
  </style>
</head>
<body>
  <div id="controls">
    <h3>Canvas</h3>
    <label>Size:
      <select id="canvasSize">
        <option value="1080x1080">Instagram Square</option>
        <option value="1080x1920">Instagram Story</option>
      </select>
    </label><br><br>

    <h3>Background Image</h3>
    <input type="file" id="bgUpload" accept="image/*"><br>
    <label>Fit:
      <select id="fitMode">
        <option value="cover">Cover</option>
        <option value="contain">Contain</option>
        <option value="stretch">Stretch</option>
      </select>
    </label><br>
    <label>Zoom:
      <input type="range" id="bgZoom" min="0.5" max="3" step="0.01" value="1">
    </label><br><br>

    <h3>Headline</h3>
    <textarea id="headlineText" rows="3" cols="30">Your headline here</textarea><br>
    <label>Font:
      <select id="fontFamily">
        <option value="'Jameel Noori Nastaleeq', serif">Jameel Noori Nastaleeq</option>
        <option value="Pangea, sans-serif">Pangea</option>
        <option value="Arial, sans-serif">Arial</option>
      </select>
    </label><br>
    <label>Size: <input type="number" id="fontSize" value="32"></label><br>
    <label>Color: <input type="color" id="fontColor" value="#000000"></label><br>
    <label>Line height: <input type="number" id="lineHeight" value="1.2" step="0.1"></label><br>
    <label>Shadow: <input type="checkbox" id="textShadow"></label><br>
    <label>Direction:
      <select id="textDir">
        <option value="ltr">LTR</option>
        <option value="rtl">RTL</option>
      </select>
    </label><br>
    <label>Sidebar line: <input type="checkbox" id="sidebarToggle"></label><br><br>

    <h3>Logo</h3>
    <label>Show logo: <input type="checkbox" id="logoToggle"></label><br>
    <label>Position:
      <select id="logoPosition">
        <option value="top-left">Top Left</option>
        <option value="top-right">Top Right</option>
        <option value="bottom-left">Bottom Left</option>
        <option value="bottom-right">Bottom Right</option>
      </select>
    </label><br><br>

    <h3>Export</h3>
    <label>File name: <input type="text" id="fileName" value="card"></label><br>
    <button id="exportBtn">Export Image</button>
  </div>

  <div id="canvas-container">
    <div id="preview">
      <img id="bg-image" src="">
      <div id="headline">Your headline here</div>
      <img id="logo" src="sabah-logo.PNG" style="display:none;">
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    const preview = document.getElementById('preview');
    const bgImage = document.getElementById('bg-image');
    const headline = document.getElementById('headline');
    const logo = document.getElementById('logo');

    // --- Canvas size ---
    function updateCanvasSize() {
      const [w, h] = document.getElementById('canvasSize').value.split('x').map(Number);
      const maxPreviewWidth = 400;
      const scale = w > h ? maxPreviewWidth / w : maxPreviewWidth / h;
      preview.style.width = (w * scale) + "px";
      preview.style.height = (h * scale) + "px";
    }
    document.getElementById('canvasSize').addEventListener('change', updateCanvasSize);
    updateCanvasSize();

    // --- Background image upload ---
    document.getElementById('bgUpload').addEventListener('change', e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = ev => bgImage.src = ev.target.result;
        reader.readAsDataURL(file);
      }
    });

    // --- Fit mode + zoom ---
    const bgState = { x: 0, y: 0, scale: 1 };
    document.getElementById('fitMode').addEventListener('change', applyBgTransform);
    document.getElementById('bgZoom').addEventListener('input', e => {
      bgState.scale = parseFloat(e.target.value);
      applyBgTransform();
    });

    function applyBgTransform() {
      const mode = document.getElementById('fitMode').value;
      if (mode === 'stretch') {
        bgImage.style.width = "100%";
        bgImage.style.height = "100%";
        bgImage.style.transform = "translate(0,0)";
      } else {
        bgImage.style.width = "auto";
        bgImage.style.height = "auto";
        bgImage.style.transform = `translate(${bgState.x}px, ${bgState.y}px) scale(${bgState.scale})`;
        bgImage.style.objectFit = mode;
      }
    }

    // --- Dragging background image ---
    let draggingBg = false, bgStart = {};
    bgImage.addEventListener('mousedown', e => {
      if (document.getElementById('fitMode').value === 'stretch') return;
      draggingBg = true; bgStart = { x: e.clientX - bgState.x, y: e.clientY - bgState.y };
      bgImage.style.cursor = "grabbing";
    });
    window.addEventListener('mousemove', e => {
      if (!draggingBg) return;
      bgState.x = e.clientX - bgStart.x;
      bgState.y = e.clientY - bgStart.y;
      applyBgTransform();
    });
    window.addEventListener('mouseup', () => { draggingBg = false; bgImage.style.cursor = "grab"; });

    // --- Headline controls ---
    function updateHeadline() {
      let txt = document.getElementById('headlineText').value;
      headline.innerHTML = txt;
      headline.style.fontFamily = document.getElementById('fontFamily').value;
      headline.style.fontSize = document.getElementById('fontSize').value + "px";
      headline.style.color = document.getElementById('fontColor').value;
      headline.style.lineHeight = document.getElementById('lineHeight').value;
      headline.style.textShadow = document.getElementById('textShadow').checked ? "2px 2px 4px rgba(0,0,0,0.5)" : "none";
      headline.dir = document.getElementById('textDir').value;

      if (document.getElementById('sidebarToggle').checked) {
        headline.classList.add("with-sidebar");
        headline.innerHTML = `<div class="sidebar"></div><div>${txt}</div>`;
      } else {
        headline.classList.remove("with-sidebar");
      }
    }
    document.querySelectorAll('#headlineText,#fontFamily,#fontSize,#fontColor,#lineHeight,#textShadow,#textDir,#sidebarToggle')
      .forEach(el => el.addEventListener('input', updateHeadline));
    updateHeadline();

    // --- Dragging headline ---
    let draggingHeadline = false, hStart = {};
    headline.addEventListener('mousedown', e => {
      draggingHeadline = true; hStart = { x: e.clientX - headline.offsetLeft, y: e.clientY - headline.offsetTop };
    });
    window.addEventListener('mousemove', e => {
      if (!draggingHeadline) return;
      headline.style.left = (e.clientX - hStart.x) + "px";
      headline.style.top = (e.clientY - hStart.y) + "px";
    });
    window.addEventListener('mouseup', () => draggingHeadline = false);

    // --- Logo controls ---
    function updateLogo() {
      if (document.getElementById('logoToggle').checked) {
        logo.style.display = "block";
        const pos = document.getElementById('logoPosition').value;
        logo.style.top = logo.style.bottom = logo.style.left = logo.style.right = "auto";
        const margin = 10;
        if (pos.includes("top")) logo.style.top = margin + "px";
        if (pos.includes("bottom")) logo.style.bottom = margin + "px";
        if (pos.includes("left")) logo.style.left = margin + "px";
        if (pos.includes("right")) logo.style.right = margin + "px";
      } else {
        logo.style.display = "none";
      }
    }
    document.querySelectorAll('#logoToggle,#logoPosition').forEach(el => el.addEventListener('change', updateLogo));

    // --- Export ---
    document.getElementById('exportBtn').addEventListener('click', () => {
      const filename = document.getElementById('fileName').value || "card";
      html2canvas(preview, { scale: 3 }).then(canvas => {
        const link = document.createElement('a');
        link.download = filename + ".png";
        link.href = canvas.toDataURL();
        link.click();
      });
    });
  </script>
</body>
</html>
