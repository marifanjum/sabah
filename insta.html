<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Social Card Generator</title>
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
	<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Fonts -->
    <style>
      @font-face {
        font-family: "Pangea Afrikan Trial";
        src: url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.eot");
        src: url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.eot?#iefix") format("embedded-opentype"),
          url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.woff2") format("woff2"),
          url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.woff") format("woff"),
          url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.ttf") format("truetype"),
          url("https://db.onlinewebfonts.com/t/11650c78ba93a8c78b44eff5c3628f9e.svg#Pangea Afrikan Trial") format("svg");
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
      function SocialCardGenerator() {
        const { useState, useRef, useEffect } = React;

        const containerRef = useRef(null);
        const textRef = useRef(null);

        const [imageSrc, setImageSrc] = useState(null);
        const [imgScale, setImgScale] = useState(1);
        const [imgOffset, setImgOffset] = useState({ x: 0, y: 0 });
        const [width, setWidth] = useState(1080);
        const [height, setHeight] = useState(1080);

        const [headline, setHeadline] = useState("Headline here");
        const [fontSize, setFontSize] = useState(72);
        const [lineHeight, setLineHeight] = useState(1.2);
        const [fontFamily, setFontFamily] = useState("Jameel Noori Nastaleeq");
        const [textColor, setTextColor] = useState("#ffffff");
        const [textPos, setTextPos] = useState({ x: 100, y: 200 });
        const [direction, setDirection] = useState("rtl");
        const [logo, setLogo] = useState({ show: true, position: "top-right" });
        const [fileName, setFileName] = useState("social-card");
		const [sidelineOffset, setSidelineOffset] = useState(0);

        const [shadow, setShadow] = useState({
          enabled: true,
          offsetX: 2,
          offsetY: 2,
          blur: 6,
          color: "rgba(0,0,0,0.6)",
        });

        const [stroke, setStroke] = useState({
          enabled: false,
          width: 1,
          color: "#000000",
        });

        const [sideline, setSideline] = useState({
          show: true,
          width: 4,
          gap: 8,
          height: 0,
          color: "#ff0000",
          opacity: 1,
        });

        const [fitMode, setFitMode] = useState("cover");

        // update sideline height when text changes if not overridden
        useEffect(() => {
          if (textRef.current && sideline.height === 0) {
            setSideline((s) => ({ ...s, height: textRef.current.offsetHeight }));
          }
        }, [headline, fontSize, lineHeight, fontFamily]);

        function onImageUpload(e) {
          const f = e.target.files && e.target.files[0];
          if (!f) return;
          const url = URL.createObjectURL(f);
          setImageSrc(url);
          setImgScale(1);
          setImgOffset({ x: 0, y: 0 });
        }

        // --- Dragging image (deltas) ---
        function startDrag(e) {
          e.preventDefault();
          const startX = e.clientX;
          const startY = e.clientY;
          const initOffset = { ...imgOffset };

          function onMove(ev) {
            setImgOffset({
              x: initOffset.x + (ev.clientX - startX),
              y: initOffset.y + (ev.clientY - startY),
            });
          }
          function onUp() {
            window.removeEventListener("mousemove", onMove);
            window.removeEventListener("mouseup", onUp);
          }

          window.addEventListener("mousemove", onMove);
          window.addEventListener("mouseup", onUp);
        }

        // --- Dragging text (deltas) ---
        function startDragText(e) {
          e.preventDefault();
          const startX = e.clientX;
          const startY = e.clientY;
          const initPos = { ...textPos };

          function onMove(ev) {
            setTextPos({
              x: initPos.x + (ev.clientX - startX),
              y: initPos.y + (ev.clientY - startY),
            });
          }
          function onUp() {
            window.removeEventListener("mousemove", onMove);
            window.removeEventListener("mouseup", onUp);
          }

          window.addEventListener("mousemove", onMove);
          window.addEventListener("mouseup", onUp);
        }

        // --- Export logic (use actual sizes, no scaling) ---
function exportAsImage() {
  if (!containerRef.current) return;

  const verticalOffset = 3; // pixels to move line slightly down in output

  html2canvas(containerRef.current, {
    useCORS: true,
    scale: 1,
    onclone: (clonedDoc) => {
      // Find the cloned sideline div and adjust its top
      const clonedLine = clonedDoc.querySelector(".sideline-clone");
      if (clonedLine) {
        const currentTop = parseFloat(clonedLine.style.top || "0");
        clonedLine.style.top = currentTop + verticalOffset + "px";
      }
    },
  }).then((canvas) => {
    const link = document.createElement("a");
    link.download = (fileName && fileName.trim() ? fileName.trim() : "social-card") + ".png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  });
};

        return (
          <div className="p-4 max-w-7xl mx-auto">
            <div className="flex gap-6">
              {/* Controls */}
              <div className="w-96 space-y-4">
                <h2 className="text-xl font-semibold">Controls</h2>

                {/* Text settings */}
                <div className="bg-white p-3 rounded shadow">
                  <label className="block text-sm font-medium">Headline</label>
                  <textarea
                    dir="rtl"
                    value={headline}
                    onChange={(e) => setHeadline(e.target.value)}
                    className="w-full border p-2 rounded"
                  />

                  <label className="block text-sm mt-2">Font size</label>
                  <input
                    type="number"
                    value={fontSize}
                    onChange={(e) => setFontSize(parseInt(e.target.value))}
                    className="w-full border p-1 rounded"
                  />
                  <label className="block text-sm mt-2">Line height</label>
                  <input
                    type="number"
                    step="0.1"
                    value={lineHeight}
                    onChange={(e) => setLineHeight(parseFloat(e.target.value))}
                    className="w-full border p-1 rounded"
                  />
                  <label className="block text-sm mt-2">Text color</label>
                  <input type="color" value={textColor} onChange={(e) => setTextColor(e.target.value)} />

                  <label className="block text-sm mt-3">Font family</label>
                  <select
                    value={fontFamily}
                    onChange={(e) => setFontFamily(e.target.value)}
                    className="w-full border p-1 rounded mt-2"
                  >
                    <option value="Jameel Noori Nastaleeq">Jameel Noori Nastaleeq</option>
                    <option value="Pangea Afrikan Trial">Pangea</option>
                    <option value="Tahoma">Tahoma</option>
                    <option value="Arial">Arial</option>
                  </select>

                  <label className="block text-sm mt-3">Text direction</label>
                  <select
                    value={direction}
                    onChange={(e) => setDirection(e.target.value)}
                    className="w-full border p-1 rounded mt-2"
                  >
                    <option value="ltr">Left to Right</option>
                    <option value="rtl">Right to Left</option>
                  </select>
                </div>

                {/* Shadow */}
                <div className="bg-white p-3 rounded shadow">
                  <label className="flex items-center">
                    <input
                      type="checkbox"
                      checked={shadow.enabled}
                      onChange={(e) => setShadow({ ...shadow, enabled: e.target.checked })}
                    />
                    <span className="ml-2">Enable shadow</span>
                  </label>
                  <div className="mt-2 grid grid-cols-2 gap-2">
                    <label className="text-sm">
                      OffsetX
                      <input
                        type="number"
                        value={shadow.offsetX}
                        onChange={(e) => setShadow({ ...shadow, offsetX: parseInt(e.target.value) })}
                        className="w-full border p-1 rounded"
                      />
                    </label>
                    <label className="text-sm">
                      OffsetY
                      <input
                        type="number"
                        value={shadow.offsetY}
                        onChange={(e) => setShadow({ ...shadow, offsetY: parseInt(e.target.value) })}
                        className="w-full border p-1 rounded"
                      />
                    </label>
                    <label className="text-sm">
                      Blur
                      <input
                        type="number"
                        value={shadow.blur}
                        onChange={(e) => setShadow({ ...shadow, blur: parseInt(e.target.value) })}
                        className="w-full border p-1 rounded"
                      />
                    </label>
                    <label className="text-sm">
                      Color
                      <input
                        type="color"
                        value={shadow.color}
                        onChange={(e) => setShadow({ ...shadow, color: e.target.value })}
                        className="w-full border p-1 rounded"
                      />
                    </label>
                  </div>
                </div>

                {/* Stroke */}
                <div className="bg-white p-3 rounded shadow">
                  <label className="flex items-center">
                    <input
                      type="checkbox"
                      checked={stroke.enabled}
                      onChange={(e) => setStroke({ ...stroke, enabled: e.target.checked })}
                    />
                    <span className="ml-2">Enable stroke</span>
                  </label>
                  {stroke.enabled && (
                    <div className="mt-2 grid grid-cols-2 gap-2">
                      <label className="text-sm">
                        Width
                        <input
                          type="number"
                          value={stroke.width}
                          onChange={(e) => setStroke({ ...stroke, width: parseInt(e.target.value) })}
                          className="w-full border p-1 rounded"
                        />
                      </label>
                      <label className="text-sm">
                        Color
                        <input
                          type="color"
                          value={stroke.color}
                          onChange={(e) => setStroke({ ...stroke, color: e.target.value })}
                          className="w-full border p-1 rounded"
                        />
                      </label>
                    </div>
                  )}
                </div>

                {/* Sideline */}
                <div className="bg-white p-3 rounded shadow">
                  <label className="flex items-center">
                    <input
                      type="checkbox"
                      checked={sideline.show}
                      onChange={(e) => setSideline({ ...sideline, show: e.target.checked })}
                    />
                    <span className="ml-2">Show sideline</span>
                  </label>
                  {sideline.show && (
                    <div className="mt-2 space-y-2">
                      <label className="block text-sm">
                        Width
                        <input
                          type="number"
                          value={sideline.width}
                          onChange={(e) => setSideline({ ...sideline, width: parseInt(e.target.value) })}
                          className="w-full border p-1 rounded"
                        />
                      </label>
                      <label className="block text-sm">
                        Gap
                        <input
                          type="number"
                          value={sideline.gap}
                          onChange={(e) => setSideline({ ...sideline, gap: parseInt(e.target.value) })}
                          className="w-full border p-1 rounded"
                        />
                      </label>
                      <label className="block text-sm">
                        Height (0 = auto)
                        <input
                          type="number"
                          value={sideline.height}
                          onChange={(e) => setSideline({ ...sideline, height: parseInt(e.target.value) })}
                          className="w-full border p-1 rounded"
                        />
                      </label>
                      <label className="block text-sm">
                        Color
                        <input
                          type="color"
                          value={sideline.color}
                          onChange={(e) => setSideline({ ...sideline, color: e.target.value })}
                          className="w-full border p-1 rounded"
                        />
                      </label>
                      <label className="block text-sm">
                        Transparency ({Math.round(sideline.opacity * 100)}%)
                        <input
                          type="range"
                          min="0"
                          max="1"
                          step="0.05"
                          value={sideline.opacity}
                          onChange={(e) => setSideline({ ...sideline, opacity: parseFloat(e.target.value) })}
                          className="w-full"
                        />
                      </label>
                    </div>
                  )}
                </div>
				
				<label className="block text-sm">
  Line vertical offset
  <input
    type="number"
    value={sidelineOffset}
    onChange={(e) => setSidelineOffset(parseInt(e.target.value))}
    className="w-full border p-1 rounded mt-1"
  />
</label>



                {/* Upload */}
                <div className="bg-white p-3 rounded shadow">
                  <label className="block text-sm font-medium">Upload image</label>
                  <input type="file" accept="image/*" onChange={onImageUpload} className="mt-2" />
                </div>

                {/* Fit mode */}
                <div className="bg-white p-3 rounded shadow">
                  <label className="block text-sm">Fit mode</label>
                  <select
                    value={fitMode}
                    onChange={(e) => setFitMode(e.target.value)}
                    className="w-full border p-1 rounded"
                  >
                    <option value="cover">Cover</option>
                    <option value="contain">Contain</option>
                    <option value="stretch">Stretch</option>
                  </select>
                  <label className="block text-sm mt-2">Zoom</label>
                  <input
                    type="range"
                    min="0.5"
                    max="3"
                    step="0.05"
                    value={imgScale}
                    onChange={(e) => setImgScale(parseFloat(e.target.value))}
                    className="w-full"
                  />
                </div>

                {/* Canvas presets */}
                <div className="bg-white p-3 rounded shadow">
                  <label className="block text-sm font-medium">Canvas size</label>
                  <div className="flex gap-2 mt-2">
                    <button
                      onClick={() => {
                        setWidth(1080);
                        setHeight(1080);
                      }}
                      className="bg-gray-200 px-3 py-1 rounded"
                    >
                      Instagram Square
                    </button>
                    <button
                      onClick={() => {
                        setWidth(1080);
                        setHeight(1920);
                      }}
                      className="bg-gray-200 px-3 py-1 rounded"
                    >
                      Instagram Story
                    </button>
                  </div>
                </div>

                <div className="bg-white p-3 rounded shadow">
                  <label className="flex items-center">
                    <input
                      type="checkbox"
                      checked={logo.show}
                      onChange={(e) => setLogo({ ...logo, show: e.target.checked })}
                    />
                    <span className="ml-2">Show Logo</span>
                  </label>

                  {logo.show && (
                    <label className="block text-sm mt-2">
                      Logo Position
                      <select
                        value={logo.position}
                        onChange={(e) => setLogo({ ...logo, position: e.target.value })}
                        className="w-full border p-1 rounded"
                      >
                        <option value="top-right">Top Right</option>
                        <option value="top-left">Top Left</option>
                        <option value="bottom-right">Bottom Right</option>
                        <option value="bottom-left">Bottom Left</option>
                      </select>
                    </label>
                  )}
                </div>

                <div className="bg-white p-3 rounded shadow">
                  <label className="block text-sm font-medium">File name (without .png)</label>
                  <input
                    type="text"
                    value={fileName}
                    onChange={(e) => setFileName(e.target.value)}
                    className="w-full border p-1 rounded mt-2"
                  />
                </div>

                <button onClick={exportAsImage} className="bg-blue-600 text-white py-2 rounded w-full">
                  Export PNG
                </button>
              </div>

              {/* Preview (actual size; no scaling) */}
              <div className="flex-1">
                <div className="sticky top-4"> {/* keeps preview node visible at top */}
                  <div className="mb-2">
                    Preview (Output size: {width}Ã—{height})
                  </div>

                  {/* IMPORTANT: preview uses actual output pixels now */}
                  <div
                    ref={containerRef}
                    className="relative mx-auto bg-black overflow-auto"
                    style={{ width: width, height: height }} // actual size, in px
                  >
                    {imageSrc && (
                      <img
                        src={imageSrc}
                        onMouseDown={startDrag}
                        style={{
                          position: "absolute",
                          left: imgOffset.x,
                          top: imgOffset.y,
                          transform: `scale(${imgScale})`,
                          transformOrigin: "center",
                          width: fitMode === "stretch" ? "100%" : "auto",
                          height: fitMode === "stretch" ? "100%" : "auto",
                          maxWidth: fitMode !== "stretch" ? "none" : "100%",
                          maxHeight: fitMode !== "stretch" ? "none" : "100%",
                          cursor: "grab",
                        }}
                      />
                    )}

					{sideline.show && (
					  <div
						className="sideline-clone"
						style={{
						  position: "absolute",
						  [direction === "ltr" ? "left" : "right"]: sideline.gap,
						  top: textPos.y + sidelineOffset,
						  height: sideline.height || (textRef.current?.offsetHeight ?? 0),
						  width: sideline.width,
						  background: sideline.color,
						  opacity: sideline.opacity,
						}}
					  />
					)}



                    {logo.show && (
                      <img
                        src="sabah-logo.PNG"
                        alt="Logo"
                        style={{
                          position: "absolute",
                          width: 120,
                          height: 60,
                          ...(logo.position === "top-left" && { left: 20, top: 150 }),
                          ...(logo.position === "top-right" && { right: 20, top: 150 }),
                          ...(logo.position === "bottom-left" && { left: 20, bottom: 50 }),
                          ...(logo.position === "bottom-right" && { right: 20, bottom: 50 }),
                        }}
                      />
                    )}

                    <div
                      ref={textRef}
                      onMouseDown={startDragText}
                      dir={direction}
                      style={{
                        position: "absolute",
                        left: textPos.x,
                        top: textPos.y,
                        fontSize,
                        lineHeight,
                        fontFamily,
                        color: textColor,
                        textShadow: shadow.enabled
                          ? `${shadow.offsetX}px ${shadow.offsetY}px ${shadow.blur}px ${shadow.color}`
                          : "none",
                        WebkitTextStroke: stroke.enabled ? `${stroke.width}px ${stroke.color}` : "none",
                        whiteSpace: "pre-wrap",
                        cursor: "move",
                      }}
                    >
                      {headline}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<SocialCardGenerator />);
    </script>
  </body>
</html>
