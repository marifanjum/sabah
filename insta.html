<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Social Card Generator</title>
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Optional Google Fonts for Pangea, Jameel Noori Nastaleeq substitute -->
    <link href="https://fonts.googleapis.com/css2?family=Arial&family=Tahoma&display=swap" rel="stylesheet" />
    <style>
      @font-face {
        font-family: "Jameel Noori Nastaleeq";
        src: url("https://cdn.jsdelivr.net/gh/usmankhi18/jameel-noori-nastaleeq/jameel-noori-nastaleeq.woff2") format("woff2");
      }
      @font-face {
        font-family: "Pangea";
        src: url("https://example.com/path-to-pangea.woff2") format("woff2"); /* Replace with real URL */
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
      function SocialCardGenerator() {
        const { useState, useRef, useEffect } = React;

        const containerRef = useRef(null);
        const textRef = useRef(null);

        const [imageSrc, setImageSrc] = useState(null);
        const [imgScale, setImgScale] = useState(1);
        const [imgOffset, setImgOffset] = useState({ x: 0, y: 0 });
        const [width, setWidth] = useState(1080);
        const [height, setHeight] = useState(1080);

        const [headline, setHeadline] = useState("Your headline goes here\nSecond line optional");
        const [fontSize, setFontSize] = useState(72);
        const [lineHeight, setLineHeight] = useState(1.2);
        const [fontFamily, setFontFamily] = useState("Arial");
        const [textColor, setTextColor] = useState("#ffffff");
        const [textPos, setTextPos] = useState({ x: 100, y: 200 });
        const [direction, setDirection] = useState("ltr");

        const [shadow, setShadow] = useState({
          enabled: true,
          offsetX: 2,
          offsetY: 2,
          blur: 6,
          color: "rgba(0,0,0,0.6)",
        });

        const [sideline, setSideline] = useState({
          show: false,
          width: 10,
          color: "#ffdd00",
          gap: 18,
          height: 0, // dynamic height
        });

        const [fitMode, setFitMode] = useState("cover");

        // --- Measure text block height dynamically ---
        useEffect(() => {
          if (textRef.current) {
            setSideline((s) => ({ ...s, height: textRef.current.offsetHeight }));
          }
        }, [headline, fontSize, lineHeight, fontFamily]);

        function onImageUpload(e) {
          const f = e.target.files && e.target.files[0];
          if (!f) return;
          const url = URL.createObjectURL(f);
          setImageSrc(url);
          setImgScale(1);
          setImgOffset({ x: 0, y: 0 });
        }

        // --- Dragging image ---
        function startDrag(e) {
          e.preventDefault();
          const startX = e.clientX;
          const startY = e.clientY;
          const initOffset = { ...imgOffset };

          function onMove(ev) {
            setImgOffset({
              x: initOffset.x + (ev.clientX - startX),
              y: initOffset.y + (ev.clientY - startY),
            });
          }
          function onUp() {
            window.removeEventListener("mousemove", onMove);
            window.removeEventListener("mouseup", onUp);
          }

          window.addEventListener("mousemove", onMove);
          window.addEventListener("mouseup", onUp);
        }

        // --- Dragging text ---
        function startDragText(e) {
          e.preventDefault();
          const startX = e.clientX;
          const startY = e.clientY;
          const initPos = { ...textPos };

          function onMove(ev) {
            setTextPos({
              x: initPos.x + (ev.clientX - startX),
              y: initPos.y + (ev.clientY - startY),
            });
          }
          function onUp() {
            window.removeEventListener("mousemove", onMove);
            window.removeEventListener("mouseup", onUp);
          }

          window.addEventListener("mousemove", onMove);
          window.addEventListener("mouseup", onUp);
        }

        return (
          <div className="p-4 max-w-7xl mx-auto">
            <div className="flex gap-6">
              {/* Controls */}
              <div className="w-96 space-y-4">
                <h2 className="text-xl font-semibold">Controls</h2>

                <div className="bg-white p-3 rounded shadow">
                  <label className="block text-sm font-medium">Font family</label>
                  <select
                    value={fontFamily}
                    onChange={(e) => setFontFamily(e.target.value)}
                    className="w-full border p-1 rounded mt-2"
                  >
                    <option value="Jameel Noori Nastaleeq">Jameel Noori Nastaleeq</option>
                    <option value="Pangea">Pangea</option>
                    <option value="Tahoma">Tahoma</option>
                    <option value="Arial">Arial</option>
                  </select>

                  <label className="block text-sm font-medium mt-3">Text direction</label>
                  <select
                    value={direction}
                    onChange={(e) => setDirection(e.target.value)}
                    className="w-full border p-1 rounded mt-2"
                  >
                    <option value="ltr">Left to Right (LTR)</option>
                    <option value="rtl">Right to Left (RTL)</option>
                  </select>
                </div>

                {/* Other existing controls remain unchanged... */}
              </div>

              {/* Preview */}
              <div className="flex-1">
                <div className="mb-2">
                  Preview (Output size: {width}Ã—{height})
                </div>
                <div
                  ref={containerRef}
                  className="relative mx-auto bg-black overflow-hidden"
                  style={{ width: 540, height: Math.round((height / width) * 540) }}
                >
                  {imageSrc && (
                    <img
                      src={imageSrc}
                      onMouseDown={startDrag}
                      style={{
                        position: "absolute",
                        left: imgOffset.x,
                        top: imgOffset.y,
                        transform: `scale(${imgScale})`,
                        transformOrigin: "center",
                        width: fitMode === "stretch" ? "100%" : "auto",
                        height: fitMode === "stretch" ? "100%" : "auto",
                        maxWidth: fitMode !== "stretch" ? "none" : "100%",
                        maxHeight: fitMode !== "stretch" ? "none" : "100%",
                        cursor: "grab",
                      }}
                    />
                  )}

                  {/* Sideline with RTL/LTR logic */}
                  {sideline.show && (
                    <div
                      style={{
                        position: "absolute",
                        [direction === "ltr" ? "left" : "right"]: sideline.gap,
                        top: textPos.y,
                        height: sideline.height,
                        width: sideline.width,
                        background: sideline.color,
                      }}
                    />
                  )}

                  {/* Text */}
                  <div
                    ref={textRef}
                    onMouseDown={startDragText}
                    dir={direction}
                    style={{
                      position: "absolute",
                      left: textPos.x,
                      top: textPos.y,
                      fontSize,
                      lineHeight,
                      fontFamily,
                      color: textColor,
                      textShadow: shadow.enabled
                        ? `${shadow.offsetX}px ${shadow.offsetY}px ${shadow.blur}px ${shadow.color}`
                        : "none",
                      whiteSpace: "pre-wrap",
                      cursor: "move",
                    }}
                  >
                    {headline}
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<SocialCardGenerator />);
    </script>
  </body>
</html>
