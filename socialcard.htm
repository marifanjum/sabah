<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Social Card Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    canvas {
      border: 2px solid #fff;
      margin-top: 20px;
      max-width: 100%;
      height: auto;
    }
    .controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 600px;
      width: 100%;
    }
    label {
      font-size: 14px;
      margin-top: 5px;
    }
    input[type="text"],
    input[type="file"],
    input[type="number"],
    input[type="color"] {
      padding: 6px;
      border-radius: 4px;
      border: none;
      width: 100%;
    }
    button {
      padding: 10px;
      background: #28a745;
      border: none;
      color: #fff;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }
    button:hover {
      background: #218838;
    }
  </style>
</head>
<body>
  <h1>Social Card Generator</h1>
  <div class="controls">
    <label>Upload Main Image:
      <input type="file" id="uploadImage">
    </label>
    <label>Headline:
      <input type="text" id="headline" placeholder="Enter your headline">
    </label>
    <label>Font Size:
      <input type="number" id="fontSize" value="40">
    </label>
    <label>Text Color:
      <input type="color" id="textColor" value="#ffffff">
    </label>
    <label>Word Spacing:
      <input type="number" id="wordSpacing" value="0">
    </label>
    <button id="downloadBtn">Download Image</button>
  </div>

  <canvas id="canvas" width="1200" height="630"></canvas>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    const uploadImage = document.getElementById("uploadImage");
    const headlineInput = document.getElementById("headline");
    const fontSizeInput = document.getElementById("fontSize");
    const textColorInput = document.getElementById("textColor");
    const wordSpacingInput = document.getElementById("wordSpacing");
    const downloadBtn = document.getElementById("downloadBtn");

    const bgImage = new Image();
    bgImage.src = "bg.png"; // Make sure file name matches exactly
    const logoImage = new Image();
    logoImage.src = "sabah-logo.png"; // Always show logo

    let mainImage = null;

    // Redraw everything
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw background
      if (bgImage.complete) {
        ctx.drawImage(bgImage, 0, 0, canvas.width, canvas.height);
      }

      // Draw uploaded main image
      if (mainImage) {
        const ratio = Math.min(canvas.width / mainImage.width, canvas.height / mainImage.height);
        const w = mainImage.width * ratio;
        const h = mainImage.height * ratio;
        const x = (canvas.width - w) / 2;
        const y = (canvas.height - h) / 2;
        ctx.drawImage(mainImage, x, y, w, h);
      }

      // Draw logo (always on top left corner)
      if (logoImage.complete) {
        ctx.drawImage(logoImage, 20, 20, 120, 100);
      }

      // Draw headline
      const headline = headlineInput.value;
      if (headline) {
        const fontSize = parseInt(fontSizeInput.value, 10) || 40;
        ctx.font = `bold ${fontSize}px Arial`;
        ctx.fillStyle = textColorInput.value;

        const words = headline.split(/\s+/);
        let x = 50;
        let y = canvas.height - 100;
        const spacing = parseInt(wordSpacingInput.value, 10) || 0;

        words.forEach(word => {
          const width = ctx.measureText(word).width;
          ctx.fillText(word, x, y);
          x += width + spacing;
        });
      }
    }

    // Event listeners
    uploadImage.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          mainImage = new Image();
          mainImage.onload = draw;
          mainImage.src = evt.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    [headlineInput, fontSizeInput, textColorInput, wordSpacingInput].forEach(input => {
      input.addEventListener("input", draw);
    });

    bgImage.onload = draw;
    logoImage.onload = draw;

    downloadBtn.addEventListener("click", () => {
      const link = document.createElement("a");
      link.download = "social-card.png";
      link.href = canvas.toDataURL();
      link.click();
    });
  </script>
</body>
</html>
